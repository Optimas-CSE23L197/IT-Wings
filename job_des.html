<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job Description</title>

    <!-- ================= FAVICONS ================= -->
    <link rel="icon" type="image/x-icon" href="images/favicon_io/favicon.ico" />

    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="images/favicon_io/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="images/favicon_io/favicon-32x32.png"
    />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="images/favicon_io/apple-touch-icon.png"
    />

    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="images/favicon_io/android-chrome-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="images/favicon_io/android-chrome-512x512.png"
    />

    <link rel="manifest" href="images/favicon_io/site.webmanifest" />

    <!-- font awsome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Owl Carousel CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css"
    />
    <!-- aos stylesheet -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

    <!-- Toastify CSS -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />

    <!-- Main CSS -->
    <link rel="stylesheet" href="css/main.css" />
  </head>

  <body>
    <!-- header  -->
    <header>
      <nav class="nav-bar">
        <div class="container">
          <div class="nav-wrapper d-flex al-center jc-between">
            <div class="logo d-flex al-center jc-between">
              <a href="index.html">
                <figure>
                  <img src="./images/Icon/logo.png" alt="logo" />
                </figure>
              </a>

              <div class="humberger d-none" id="humberger">
                <i class="fa-solid fa-bars"></i>
              </div>
            </div>
            <div class="nav-menu">
              <ul class="d-flex al-center">
                <li id="nav-home">
                  <a href="index.html">Home</a>
                </li>
                <li id="nav-about">
                  <a href="about.html">About Us</a>
                </li>
                <li id="nav-service">
                  <a href="#">Service</a>
                </li>
                <li id="nav-career">
                  <a href="career.html" class="active">Career</a>
                </li>
                <li><a href="#" id="nav-contact">Contact Us</a></li>
              </ul>
            </div>
            <div class="contact-btn">
              <a href="request.html" target="_blank">Get in touch</a>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <!-- home section -->
    <section class="home-menu-service-setion" id="home-menu-service-setion">
      <div class="home-menu-service-container">
        <div class="nav-service-wrapper">
          <div class="nav-banner">
            <div class="list">
              <h2>All</h2>
              <ul>
                <li><a href="./service.html">Govt.</a></li>
                <li><a href="./service.html">Tech</a></li>
                <li>
                  <a href="./service.html">Promotional</a>
                </li>
                <li><a href="./service.html">Others</a></li>
              </ul>
            </div>

            <div class="list">
              <h2>Govt</h2>
              <ul>
                <li><a href="./serviceInfo.html?id=aadher">Aadher</a></li>
                <li><a href="./serviceInfo.html?id=pan">PAN</a></li>
                <li><a href="./serviceInfo.html?id=voter">Voter</a></li>
                <li><a href="./serviceInfo.html?id=home-loan">Home Loan</a></li>
                <li>
                  <a href="./serviceInfo.html?id=business-loan"
                    >Business Loan</a
                  >
                </li>
                <li>
                  <a href="./serviceInfo.html?id=govt-more">See More...</a>
                </li>
              </ul>
            </div>

            <div class="list">
              <h2>Tech</h2>
              <ul>
                <li>
                  <a href="./serviceInfo.html?id=web-development"
                    >Web development</a
                  >
                </li>
                <li>
                  <a href="./serviceInfo.html?id=app-development"
                    >App Development</a
                  >
                </li>
                <li><a href="./serviceInfo.html?id=api">API</a></li>
                <li><a href="./serviceInfo.html?id=cloud">Cloud</a></li>
                <li><a href="./serviceInfo.html?id=course">Course</a></li>
                <li>
                  <a href="./service.html">See More...</a>
                </li>
              </ul>
            </div>

            <div class="list">
              <h2>Promotional</h2>
              <ul>
                <li><a href="./serviceInfo.html?id=facebook">Facebook</a></li>
                <li><a href="./serviceInfo.html?id=youtube">Youtube</a></li>
                <li><a href="./serviceInfo.html?id=instagram">Instagram</a></li>
                <li><a href="./serviceInfo.html?id=twitter">Twitter</a></li>
                <li><a href="./serviceInfo.html?id=threads">Threads</a></li>
                <li>
                  <a href="./service.html">See More...</a>
                </li>
              </ul>
            </div>

            <div class="list">
              <h2>Others</h2>
              <ul>
                <li>
                  <a href="./serviceInfo.html?id=graphics-design"
                    >Graphics design</a
                  >
                </li>
                <li>
                  <a href="./serviceInfo.html?id=logo-design">Logo design</a>
                </li>
                <li><a href="./serviceInfo.html?id=ui-ux">UI/UX</a></li>
                <li>
                  <a href="./serviceInfo.html?id=ads-design">Ads design</a>
                </li>
                <li>
                  <a href="./service.html">See More...</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contact Section -->
    <section class="contact-nav-section" id="contact-nav-section">
      <div class="home-menu-service-container">
        <div class="nav-service-wrapper">
          <div class="nav-contact-content">
            <div class="text">
              <h2>What’s on your mind?</h2>
              <p>
                We’re here to help! Tell us what you’re looking for and we’ll
                get you connected to the right people.
              </p>
            </div>
          </div>
          <div class="contact-option">
            <ul>
              <li><a href="request.html">Request a Service</a></li>
              <li><a href="about.html">Know About Us</a></li>
              <li><a href="jobs.html">Join Us</a></li>
              <li><a href="contact.html">Contact Us</a></li>
              <li>
                <a href="https://it-wings-learn.netlify.app/" target="_blank"
                  >Learn With Us</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Floating Contact Widget -->
    <section class="social-contact-section">
      <!-- Main Message Icon (Trigger) -->
      <div class="contact-trigger">
        <i class="fa-solid fa-message"></i>
      </div>

      <!-- Hidden Popup -->
      <ul class="contact-popup">
        <li>
          <a href="#">
            <figure>
              <img src="images/Icon/whatsapp.png" alt="whatsapp" />
            </figure>
          </a>
        </li>
        <li>
          <a href="#"
            ><figure>
              <img src="images/Icon/gmail.png" alt="email" /></figure
          ></a>
        </li>
        <li>
          <a href="#"
            ><figure>
              <img src="images/Icon/aratai.png" alt="aratai" /></figure
          ></a>
        </li>
        <li>
          <a href="#"
            ><figure>
              <img src="images/Icon/telephone.png" alt="telephone" /></figure
          ></a>
        </li>
        <li>
          <a href="#"
            ><figure>
              <img src="images/Icon/telegram.png" alt="telegram" /></figure
          ></a>
        </li>
      </ul>
    </section>

    <!-- Banner -->
    <section
      class="job-banner"
      style="background-image: url('images/career/career-5.jpg')"
    >
      <div class="container">
        <div class="banner-content">
          <h1 id="jobTitle">Loading...</h1>
          <p id="shortDescription"></p>
        </div>
      </div>
    </section>

    <!-- Job Description -->
    <main>
      <section class="job-description-section">
        <div class="container">
          <div class="job-content-wrapper">
            <!-- Left Content -->
            <div class="job-details">
              <h2 class="section-title">Job Description</h2>

              <div class="job-details-grid">
                <div class="job-item">
                  <span>Skill Set:</span> <span id="skills"></span>
                </div>
                <div class="job-item">
                  <span>Total Experience:</span> <span id="experience"></span>
                </div>
                <div class="job-item">
                  <span>Location:</span> <span id="location"></span>
                </div>
                <div class="job-item"><span>Domain:</span> IT</div>
                <div class="job-item">
                  <span>Openings:</span> <span id="openings"></span>
                </div>
                <div class="job-item">
                  <span>Posted:</span> <span id="postedDate"></span>
                </div>
                <div class="job-item">
                  <span>Expiry:</span> <span id="expiryDate"></span>
                </div>
                <div class="job-item">
                  <span>Reference No:</span> <span id="referenceNumber"></span>
                </div>
              </div>

              <hr />

              <h2 class="section-title">Job Summary</h2>
              <p id="fullDescription" class="job-summary"></p>
            </div>

            <!-- Apply Box -->
            <aside class="apply-box">
              <div class="apply-card">
                <h3>Interested in this role?</h3>
                <p>Be part of our growing technology team.</p>
                <a href="#careers-contact" class="apply-btn">Apply Now</a>
              </div>
            </aside>
          </div>
        </div>
      </section>

      <!-- Resume Form -->
      <section class="careers-contact" id="careers-contact">
        <div class="container">
          <div class="careers-wrapper">
            <div class="apply">
              <h2>Post Your Resume / Registration</h2>
              <p class="note">(*) Asterisk denotes mandatory fields</p>

              <form id="applyForm">
                <div class="row">
                  <div class="input-box">
                    <label>First Name *</label>
                    <input
                      type="text"
                      name="firstName"
                      placeholder="Enter your first name"
                    />
                  </div>
                  <div class="input-box">
                    <label>Last Name *</label>
                    <input
                      type="text"
                      name="lastName"
                      placeholder="Enter your last name"
                    />
                  </div>
                </div>

                <div class="row">
                  <div class="input-box">
                    <label>Country *</label>
                    <select name="country">
                      <option value="">Select Country</option>
                      <option>India</option>
                      <option>USA</option>
                      <option>UK</option>
                      <option>Canada</option>
                    </select>
                  </div>

                  <div class="input-box">
                    <label>Experience *</label>
                    <select name="experience">
                      <option value="">Select Experience</option>
                      <option>Fresher</option>
                      <option>1-2 Years</option>
                      <option>2-5 Years</option>
                      <option>5+ Years</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <div class="input-box">
                    <label>Email *</label>
                    <input
                      type="email"
                      name="email"
                      placeholder="Enter your email"
                    />
                  </div>
                  <div class="input-box">
                    <label>State *</label>
                    <input
                      type="state"
                      name="state"
                      placeholder="Enter your state"
                    />
                  </div>
                </div>

                <div class="row">
                  <div class="input-box">
                    <label>Application Type *</label>
                    <select name="applicationType">
                      <option value="">Select Type</option>
                      <option>Full-Time</option>
                      <option>Part-Time</option>
                      <option>Freelance</option>
                      <option>Internship</option>
                      <option>Contract</option>
                    </select>
                  </div>

                  <div class="input-box">
                    <label>Skills *</label>
                    <input
                      type="text"
                      name="skills"
                      placeholder="Enter up to 5 skills"
                    />
                  </div>
                </div>

                <div class="row">
                  <div class="input-box">
                    <label>Country Code *</label>
                    <select name="countryCode">
                      <option value="">Choose</option>
                      <option>+91</option>
                      <option>+1</option>
                      <option>+44</option>
                    </select>
                  </div>

                  <div class="input-box">
                    <label>Mobile Number *</label>
                    <input
                      type="tel"
                      name="mobileNumber"
                      maxlength="10"
                      placeholder="Enter mobile number"
                    />
                  </div>
                </div>

                <div class="row">
                  <div class="input-box">
                    <label>Upload Resume *</label>
                    <input
                      type="file"
                      name="resumeFile"
                      accept=".pdf,.doc,.docx,.rtf"
                    />
                  </div>
                </div>

                <button type="submit" class="submit-btn">
                  Submit Application
                </button>
              </form>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- footer -->
    <footer class="footer">
      <div class="footer-cta">
        <div class="container">
          <h2>Ready to work with us?</h2>
          <p>
            Join us to experience cutting-edge industrial solutions that drive
            innovation and lasting success.
          </p>
          <a href="request.html" class="btn-primary">Get in Touch</a>
        </div>
      </div>

      <div class="footer-main">
        <div class="container footer-grid">
          <!-- Logo & About -->
          <div class="footer-col about">
            <img
              src="images/service-banner.jpg"
              alt="ProFactory Logo"
              class="footer-logo"
            />
            <p>
              We are committed to providing personalized industrial solutions
              that transform your business.
            </p>
            <div class="social-icons">
              <a href="#" target="_blank"
                ><i class="fa-brands fa-linkedin-in"></i
              ></a>
              <a href="#" target="_blank"
                ><i class="fa-brands fa-x-twitter"></i
              ></a>
              <a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a>
              <a href="#" target="_blank"><i class="fab fa-instagram"></i></a>
              <a href="#" target="_blank"
                ><i class="fa-brands fa-youtube"></i
              ></a>
            </div>
          </div>

          <!-- Quick Links -->
          <div class="footer-col">
            <h4>Quick Links</h4>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><a href="about.html">About Us</a></li>
              <li><a href="service.html">Services</a></li>
            </ul>
          </div>

          <!-- Legal -->
          <div class="footer-col">
            <h4>Security</h4>
            <ul>
              <li><a href="terms-conditions.html">Terms & Conditions</a></li>
              <li><a href="privacy-policy.html">Privacy Policy</a></li>
              <li><a href="contact.html">Contact Us</a></li>
            </ul>
          </div>

          <!-- Contact Info -->
          <div class="footer-col">
            <h4>Contact</h4>
            <ul class="contact-info">
              <li><a href="tel:+91123654789">+91 123654789</a></li>
              <li>
                <a href="mailto:info@domainname.com">info@domainname.com</a>
              </li>
              <li>
                <a href="https://goo.gl/maps/XYZ" target="_blank"
                  >520, West Valley, Amin and Minim</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2025 IT-Wings Webtech Solutions. All Rights Reserved.</p>
      </div>
    </footer>

    <!-- Toastify JS -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- Main Validation Script -->
    <script>
      /* ------------------------------------------------------
        Fetch Job Details
      ------------------------------------------------------- */
      const urlParams = new URLSearchParams(window.location.search);
      const referenceNumber = urlParams.get("reference_number");

      if (!referenceNumber) {
        Toastify({
          text: "Invalid job reference number!",
          duration: 3000,
          gravity: "top",
          position: "right",
          backgroundColor: "#E63946",
        }).showToast();
      }

      async function fetchJobDetails() {
        try {
          const response = await fetch(
            `https://official-it-wings-backend.onrender.com/api/jobs/get_job.php?reference_number=${referenceNumber}`
          );
          const result = await response.json();

          if (!result.data) {
            document.querySelector(".job-details").innerHTML =
              "<p>Job not found.</p>";
            return;
          }

          const job = result.data;
          console.log(job);

          document.getElementById("jobTitle").textContent = job.job_title;
          document.getElementById("shortDescription").textContent =
            job.short_description;
          document.getElementById("fullDescription").textContent =
            job.full_description;
          document.getElementById("location").textContent = job.location;
          document.getElementById("openings").textContent = job.openings;
          document.getElementById("postedDate").textContent = job.posted_date;
          document.getElementById("expiryDate").textContent = job.expiry_date;
          document.getElementById(
            "experience"
          ).textContent = `${job.experience_min} - ${job.experience_max} Years`;
          document.getElementById("referenceNumber").textContent =
            job.reference_number;

          // ensure skillset is array
          const skills =
            typeof job.skillset === "string"
              ? JSON.parse(job.skillset)
              : job.skillset;

          document.getElementById("skills").innerHTML = skills
            ?.map((s) => `<span>${s}</span>`)
            .join(" ");
        } catch (error) {
          console.error("Error fetching job:", error);
        }
      }
      fetchJobDetails();

      /* ------------------------------------------------------
         Form Validation + Submission
      ------------------------------------------------------- */
      const form = document.getElementById("applyForm");

      const fields = {
        firstName: form.querySelector("[name='firstName']"),
        lastName: form.querySelector("[name='lastName']"),
        country: form.querySelector("[name='country']"),
        experience: form.querySelector("[name='experience']"),
        email: form.querySelector("[name='email']"),
        state: form.querySelector("[name='state']"),
        applicationType: form.querySelector("[name='applicationType']"),
        skills: form.querySelector("[name='skills']"),
        countryCode: form.querySelector("[name='countryCode']"),
        mobileNumber: form.querySelector("[name='mobileNumber']"),
        resumeFile: form.querySelector("[name='resumeFile']"),
      };

      function showError(message, field = null) {
        Toastify({
          text: message,
          duration: 3000,
          gravity: "top",
          position: "right",
          backgroundColor: "#E63946",
        }).showToast();

        if (field) {
          field.style.border = "1px solid red";
          field.focus();
          setTimeout(() => (field.style.border = ""), 2000);
        }
        return false;
      }

      function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      function validatePhone(num) {
        return /^[0-9]{10}$/.test(num);
      }

      function validateFileType(file) {
        const allowed = [
          "application/pdf",
          "application/msword",
          "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
          "application/rtf",
        ];
        return allowed.includes(file.type);
      }

      function validateForm() {
        const f = fields;

        if (!f.firstName.value.trim())
          return showError("First Name required", f.firstName);
        if (!f.lastName.value.trim())
          return showError("Last Name required", f.lastName);
        if (!f.country.value) return showError("Select country", f.country);
        if (!f.experience.value)
          return showError("Select experience", f.experience);

        if (!f.email.value.trim()) return showError("Email required", f.email);
        if (!validateEmail(f.email.value.trim()))
          return showError("Invalid email format", f.email);

        if (!f.state.value.trim()) return showError("State required", f.state);

        if (!f.applicationType.value)
          return showError("Select application type", f.applicationType);

        if (!f.skills.value.trim())
          return showError("Skills required", f.skills);

        const skillList = f.skills.value
          .split(",")
          .map((s) => s.trim())
          .filter(Boolean);
        if (skillList.length > 5)
          return showError("Max 5 skills allowed", f.skills);

        if (!f.countryCode.value)
          return showError("Select country code", f.countryCode);

        if (!validatePhone(f.mobileNumber.value.trim()))
          return showError("Invalid mobile number", f.mobileNumber);

        if (f.resumeFile.files.length === 0)
          return showError("Upload resume", f.resumeFile);

        const file = f.resumeFile.files[0];
        if (!validateFileType(file))
          return showError("Only PDF, DOC, DOCX, RTF allowed", f.resumeFile);
        if (file.size > 5 * 1024 * 1024)
          return showError("File must be under 5MB", f.resumeFile);

        return true;
      }

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        if (!validateForm()) return;

        const f = fields;
        const formData = new FormData();

        formData.append("firstName", f.firstName.value.trim());
        formData.append("lastName", f.lastName.value.trim());
        formData.append("country", f.country.value);
        formData.append("experience", f.experience.value);
        formData.append("email", f.email.value.trim());
        formData.append("state", f.state.value.trim());
        formData.append("applicationType", f.applicationType.value);
        formData.append("skills", f.skills.value.trim());
        formData.append("countryCode", f.countryCode.value);
        formData.append("mobileNumber", f.mobileNumber.value.trim());
        formData.append("reference_number", referenceNumber);
        formData.append("resumeFile", f.resumeFile.files[0]);

        try {
          const response = await fetch(
            "http://127.0.0.1:8081/main/api/v1/application/submit",
            { method: "POST", body: formData }
          );

          const result = await response.json();

          if (response.ok) {
            Toastify({
              text: "Application submitted successfully!",
              duration: 3000,
              gravity: "top",
              position: "right",
              backgroundColor: "#27ae60",
            }).showToast();

            form.reset();
          } else {
            Toastify({
              text: result.message || "Submission failed",
              duration: 3000,
              gravity: "top",
              position: "right",
              backgroundColor: "#E63946",
            }).showToast();
          }
        } catch (err) {
          Toastify({
            text: "Server error. Try again later.",
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "#E63946",
          }).showToast();
          console.error("POST ERROR:", err);
        }
      });
    </script>
    <script src="js/main.js"></script>
  </body>
</html>
