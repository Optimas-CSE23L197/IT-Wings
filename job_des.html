<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job Description</title>

    <!-- font awsome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Owl Carousel CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css"
    />
    <!-- aos stylesheet -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

    <!-- Toastify CSS -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />

    <!-- Main CSS -->
    <link rel="stylesheet" href="css/main.css" />
  </head>

  <body>
    <!-- header  -->
    <header>
      <nav class="nav-bar">
        <div class="container">
          <div class="nav-wrapper d-flex al-center jc-between">
            <div class="logo d-flex al-center jc-between">
              <a href="#">
                <figure>
                  <img src="images/Baby.png" alt="logo" />
                </figure>
              </a>

              <div class="humberger d-none" id="humberger">
                <i class="fa-solid fa-bars"></i>
              </div>
            </div>
            <div class="nav-menu">
              <ul class="d-flex al-center">
                <li id="nav-home">
                  <a href="index.html">Home</a>
                </li>
                <li id="nav-about">
                  <a href="about.html">About Us</a>
                </li>
                <li id="nav-service">
                  <a href="#">Service</a>
                </li>
                <li id="nav-career">
                  <a href="career.html" class="active">Career</a>
                </li>
                <li><a href="#" id="nav-contact">Contact Us</a></li>
              </ul>
            </div>
            <div class="contact-btn">
              <a href="request.html" target="_blank">Get in touch</a>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <!-- home section -->
    <section class="home-menu-service-setion" id="home-menu-service-setion">
      <div class="home-menu-service-container">
        <div class="nav-service-wrapper">
          <div class="nav-banner">
            <div class="list">
              <h2>All</h2>
              <ul>
                <li>Govt.</li>
                <li>Tech</li>
                <li>Promotional</li>
                <li>Others</li>
              </ul>
            </div>
            <div class="list">
              <h2>Govt</h2>
              <ul>
                <li>Aadher</li>
                <li>PAN</li>
                <li>Voter</li>
                <li>Home Loan</li>
                <li>Business Loan</li>
                <li>See More...</li>
              </ul>
            </div>
            <div class="list">
              <h2>Tech</h2>
              <ul>
                <li>
                  <a href="./serviceInfo.html?id=web-development"
                    >Web development</a
                  >
                </li>
                <li>App Development</li>
                <li>API</li>
                <li>Cloud</li>
                <li>Course</li>
                <li>See More...</li>
              </ul>
            </div>
            <div class="list">
              <h2>Promotional</h2>
              <ul>
                <li>Facebook</li>
                <li>Youtube</li>
                <li>Instagram</li>
                <li>Twitter</li>
                <li>Threads</li>
                <li>See More...</li>
              </ul>
            </div>
            <div class="list">
              <h2>Others</h2>
              <ul>
                <li>Graphics design</li>
                <li>Logo design</li>
                <li>UI/UX</li>
                <li>Ads design</li>
                <li>See More...</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contact Section -->
    <section class="contact-nav-section" id="contact-nav-section">
      <div class="home-menu-service-container">
        <div class="nav-service-wrapper">
          <div class="nav-contact-content">
            <div class="text">
              <h2>Whatâ€™s on your mind?</h2>
              <p>
                Weâ€™re here to help! Tell us what youâ€™re looking for and weâ€™ll
                get you connected to the right people.
              </p>
            </div>
          </div>
          <div class="contact-option">
            <ul>
              <li><a href="request.html">Request a Service</a></li>
              <li><a href="about.html">Know About Us</a></li>
              <li><a href="jobs.html">Join Us</a></li>
              <li><a href="contact.html">Contact Us</a></li>
              <li><a href="#">Learn With Us</a></li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Floating Contact Widget -->
    <section class="social-contact-section">
      <!-- Main Message Icon (Trigger) -->
      <div class="contact-trigger">
        <i class="fa-solid fa-message"></i>
      </div>

      <!-- Hidden Popup -->
      <ul class="contact-popup">
        <li>
          <a href="#"><i class="fa-brands fa-whatsapp"></i></a>
        </li>
        <li>
          <a href="#"><i class="fa-solid fa-envelope"></i></a>
        </li>
        <li>
          <a href="#"><i class="fa-solid fa-phone"></i></a>
        </li>
        <li>
          <a href="#"><i class="fa-brands fa-telegram"></i></a>
        </li>
      </ul>
    </section>

    <!-- Banner -->
    <section
      class="job-banner"
      style="background-image: url('images/career/career-5.jpg')"
    >
      <div class="container">
        <div class="banner-content">
          <h1 id="jobTitle">Loading...</h1>
          <p id="shortDescription"></p>
        </div>
      </div>
    </section>

    <!-- Job Description -->
    <main>
      <section class="job-description-section">
        <div class="container">
          <div class="job-content-wrapper">
            <!-- Left Content -->
            <div class="job-details">
              <h2 class="section-title">Job Description</h2>

              <div class="job-details-grid">
                <div class="job-item">
                  <span>Skill Set:</span> <span id="skills"></span>
                </div>
                <div class="job-item">
                  <span>Total Experience:</span> <span id="experience"></span>
                </div>
                <div class="job-item">
                  <span>Location:</span> <span id="location"></span>
                </div>
                <div class="job-item"><span>Domain:</span> IT</div>
                <div class="job-item">
                  <span>Openings:</span> <span id="openings"></span>
                </div>
                <div class="job-item">
                  <span>Posted:</span> <span id="postedDate"></span>
                </div>
                <div class="job-item">
                  <span>Expiry:</span> <span id="expiryDate"></span>
                </div>
                <div class="job-item">
                  <span>Reference No:</span> <span id="referenceNumber"></span>
                </div>
              </div>

              <hr />

              <h2 class="section-title">Job Summary</h2>
              <p id="fullDescription" class="job-summary"></p>
            </div>

            <!-- Apply Box -->
            <aside class="apply-box">
              <div class="apply-card">
                <h3>Interested in this role?</h3>
                <p>Be part of our growing technology team.</p>
                <a href="#careers-contact" class="apply-btn">Apply Now</a>
              </div>
            </aside>
          </div>
        </div>
      </section>

      <!-- Resume Form -->
      <section class="careers-contact" id="careers-contact">
        <div class="container">
          <div class="careers-wrapper">
            <div class="apply">
              <h2>Post Your Resume / Registration</h2>
              <p class="note">(*) Asterisk denotes mandatory fields</p>

              <form id="applyForm">
                <div class="row">
                  <div class="input-box">
                    <label>First Name *</label>
                    <input
                      type="text"
                      name="firstName"
                      placeholder="Enter your first name"
                    />
                  </div>
                  <div class="input-box">
                    <label>Last Name *</label>
                    <input
                      type="text"
                      name="lastName"
                      placeholder="Enter your last name"
                    />
                  </div>
                </div>

                <div class="row">
                  <div class="input-box">
                    <label>Country *</label>
                    <select name="country">
                      <option value="">Select Country</option>
                      <option>India</option>
                      <option>USA</option>
                      <option>UK</option>
                      <option>Canada</option>
                    </select>
                  </div>

                  <div class="input-box">
                    <label>Experience *</label>
                    <select name="experience">
                      <option value="">Select Experience</option>
                      <option>Fresher</option>
                      <option>1-2 Years</option>
                      <option>2-5 Years</option>
                      <option>5+ Years</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <div class="input-box">
                    <label>Email *</label>
                    <input
                      type="email"
                      name="email"
                      placeholder="Enter your email"
                    />
                  </div>
                  <div class="input-box">
                    <label>State *</label>
                    <input
                      type="state"
                      name="state"
                      placeholder="Enter your state"
                    />
                  </div>
                </div>

                <div class="row">
                  <div class="input-box">
                    <label>Application Type *</label>
                    <select name="applicationType">
                      <option value="">Select Type</option>
                      <option>Full-Time</option>
                      <option>Part-Time</option>
                      <option>Freelance</option>
                      <option>Internship</option>
                      <option>Contract</option>
                    </select>
                  </div>

                  <div class="input-box">
                    <label>Skills *</label>
                    <input
                      type="text"
                      name="skills"
                      placeholder="Enter up to 5 skills"
                    />
                  </div>
                </div>

                <div class="row">
                  <div class="input-box">
                    <label>Country Code *</label>
                    <select name="countryCode">
                      <option value="">Choose</option>
                      <option>+91</option>
                      <option>+1</option>
                      <option>+44</option>
                    </select>
                  </div>

                  <div class="input-box">
                    <label>Mobile Number *</label>
                    <input
                      type="tel"
                      name="mobileNumber"
                      maxlength="10"
                      placeholder="Enter mobile number"
                    />
                  </div>
                </div>

                <div class="row">
                  <div class="input-box">
                    <label>Upload Resume *</label>
                    <input
                      type="file"
                      name="resumeFile"
                      accept=".pdf,.doc,.docx,.rtf"
                    />
                  </div>
                </div>

                <button type="submit" class="submit-btn">
                  Submit Application
                </button>
              </form>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- footer -->
    <footer class="footer">
      <div class="footer-cta">
        <div class="container">
          <h2>Ready to work with us?</h2>
          <p>
            Join us to experience cutting-edge industrial solutions that drive
            innovation and lasting success.
          </p>
          <a href="request.html" class="btn-primary">Get in Touch</a>
        </div>
      </div>

      <div class="footer-main">
        <div class="container footer-grid">
          <!-- Logo & About -->
          <div class="footer-col about">
            <img
              src="images/service-banner.jpg"
              alt="ProFactory Logo"
              class="footer-logo"
            />
            <p>
              We are committed to providing personalized industrial solutions
              that transform your business.
            </p>
            <div class="social-icons">
              <a href="#" target="_blank"
                ><i class="fa-brands fa-linkedin-in"></i
              ></a>
              <a href="#" target="_blank"
                ><i class="fa-brands fa-x-twitter"></i
              ></a>
              <a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a>
              <a href="#" target="_blank"><i class="fab fa-instagram"></i></a>
              <a href="#" target="_blank"
                ><i class="fa-brands fa-youtube"></i
              ></a>
            </div>
          </div>

          <!-- Quick Links -->
          <div class="footer-col">
            <h4>Quick Links</h4>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><a href="about.html">About Us</a></li>
              <li><a href="service.html">Services</a></li>
            </ul>
          </div>

          <!-- Legal -->
          <div class="footer-col">
            <h4>Security</h4>
            <ul>
              <li><a href="#">Terms & Conditions</a></li>
              <li><a href="#">Privacy Policy</a></li>
              <li><a href="#">Help</a></li>
              <li><a href="contact.html">Contact Us</a></li>
            </ul>
          </div>

          <!-- Contact Info -->
          <div class="footer-col">
            <h4>Contact</h4>
            <ul class="contact-info">
              <li><a href="tel:+91123654789">+91 123654789</a></li>
              <li>
                <a href="mailto:info@domainname.com">info@domainname.com</a>
              </li>
              <li>
                <a href="https://goo.gl/maps/XYZ" target="_blank"
                  >520, West Valley, Amin and Minim</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2025 IT-Wings Webtech Solutions. All Rights Reserved.</p>
      </div>
    </footer>

    <!-- Toastify JS -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- Main Validation Script -->
    <script>
      /* ------------------------------------------------------
      Fetch Job Details from API
    ------------------------------------------------------- */
      const urlParams = new URLSearchParams(window.location.search);
      const referenceNumber = urlParams.get("ref");

      if (!referenceNumber) {
        showError("Invalid job reference number!");
      }

      async function fetchJobDetails() {
        try {
          const response = await fetch(
            `http://127.0.0.1:8085/main/api/v1/job/ref/${referenceNumber}`
          );
          const result = await response.json();

          if (!result.data) {
            document.querySelector(".job-details").innerHTML =
              "<p>Job not found.</p>";
            return;
          }

          const job = result.data;

          document.getElementById("jobTitle").textContent = job.jobTitle;
          document.getElementById("shortDescription").textContent =
            job.shortDescription;
          document.getElementById("fullDescription").textContent =
            job.fullDescription;
          document.getElementById("location").textContent = job.location;
          document.getElementById("openings").textContent = job.openings;
          document.getElementById("postedDate").textContent = job.postedDate;
          document.getElementById("expiryDate").textContent = job.expiryDate;
          document.getElementById(
            "experience"
          ).textContent = `${job.experienceMin} - ${job.experienceMax} Years`;
          document.getElementById("referenceNumber").textContent =
            job.referenceNumber;

          document.getElementById("skills").innerHTML = job.skillSet
            .map((s) => `<span>${s}</span>`)
            .join(", ");
        } catch (error) {
          console.error("Error:", error);
        }
      }

      fetchJobDetails();

      /* ------------------------------------------------------
       ðŸ”¥ Form Validation + Toastify Alerts
    ------------------------------------------------------- */
      const form = document.getElementById("applyForm");

      const fields = {
        firstName: form.querySelector("[name='firstName']"),
        lastName: form.querySelector("[name='lastName']"),
        country: form.querySelector("[name='country']"),
        experience: form.querySelector("[name='experience']"),
        email: form.querySelector("[name='email']"),
        applicationType: form.querySelector("[name='applicationType']"),
        skills: form.querySelector("[name='skills']"),
        countryCode: form.querySelector("[name='countryCode']"),
        mobileNumber: form.querySelector("[name='mobileNumber']"),
        resumeFile: form.querySelector("[name='resumeFile']"),
      };

      function showError(message, field = null) {
        Toastify({
          text: message,
          duration: 3000,
          close: true,
          gravity: "top",
          position: "right",
          backgroundColor: "#E63946",
        }).showToast();

        if (field) {
          field.focus();
          field.style.border = "1px solid #E63946";
          setTimeout(() => (field.style.border = ""), 2500);
        }

        return false;
      }

      function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      function validatePhone(num) {
        return /^[0-9]{10}$/.test(num);
      }

      function validateFileType(file) {
        const allowed = [
          "application/pdf",
          "application/msword",
          "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
          "application/rtf",
        ];
        return allowed.includes(file.type);
      }

      function validateForm() {
        const {
          firstName,
          lastName,
          country,
          experience,
          email,
          applicationType,
          skills,
          countryCode,
          mobileNumber,
          resumeFile,
        } = fields;

        if (!firstName.value.trim())
          return showError("First Name is required", firstName);
        if (!lastName.value.trim())
          return showError("Last Name is required", lastName);
        if (!country.value)
          return showError("Please select a country", country);
        if (!experience.value)
          return showError("Please select experience", experience);

        if (!email.value.trim()) return showError("Email is required", email);
        if (!validateEmail(email.value.trim()))
          return showError("Invalid email format", email);

        if (!applicationType.value)
          return showError("Please select application type", applicationType);

        if (!skills.value.trim())
          return showError("Skills are required", skills);

        const skillList = skills.value
          .split(",")
          .map((s) => s.trim())
          .filter(Boolean);
        if (skillList.length > 5)
          return showError("Maximum 5 skills allowed", skills);

        if (!countryCode.value)
          return showError("Please select country code", countryCode);
        if (!validatePhone(mobileNumber.value.trim()))
          return showError("Enter valid 10-digit mobile number", mobileNumber);

        if (resumeFile.files.length === 0)
          return showError("Please upload your resume", resumeFile);

        const file = resumeFile.files[0];
        if (!validateFileType(file))
          return showError("Only PDF, DOC, DOCX, RTF allowed", resumeFile);
        if (file.size > 5 * 1024 * 1024)
          return showError("File must be under 5MB", resumeFile);

        return true;
      }

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        if (!validateForm()) return;

        // Build FormData for upload
        const formData = new FormData();
        formData.append("firstName", fields.firstName.value.trim());
        formData.append("lastName", fields.lastName.value.trim());
        formData.append("country", fields.country.value);
        formData.append("experience", fields.experience.value);
        formData.append("email", fields.email.value.trim());
        formData.append("applicationType", fields.applicationType.value);
        formData.append("skills", fields.skills.value.trim());
        formData.append("countryCode", fields.countryCode.value);
        formData.append("mobileNumber", fields.mobileNumber.value.trim());
        formData.append("resumeFile", fields.resumeFile.files[0]);
        formData.append("referenceNumber", referenceNumber);

        try {
          const response = await fetch(
            "http://127.0.0.1:8085/main/api/v1/application/submit",
            {
              method: "POST",
              body: formData,
            }
          );

          const result = await response.json();

          if (response.ok) {
            Toastify({
              text: "Application submitted successfully!",
              duration: 3000,
              gravity: "top",
              position: "right",
              backgroundColor: "#27ae60",
            }).showToast();

            form.reset(); // Clear the form
          } else {
            Toastify({
              text: result.message || "Failed to submit application.",
              duration: 3000,
              gravity: "top",
              position: "right",
              backgroundColor: "#E63946",
            }).showToast();
          }
        } catch (error) {
          Toastify({
            text: "Server error. Please try again later.",
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "#E63946",
          }).showToast();

          console.error("POST Error:", error);
        }
      });
    </script>
  </body>
</html>
